{% set deployment = env['deployment'] %}
{% set project = env['project'] %}
{% set projectNumber = env['project_number'] %}
{% set zone = properties['zone'] %}
{% set licenseKey = properties['licenseKey'] %}
{% set metaNodeMachineType = properties['metaNodeMachineType'] %}
{% set metaNodeDiskType = properties['metaNodeDiskType'] %}
{% set metaNodeDiskSizeGb = properties['metaNodeDiskSizeGb'] %}
{% set dataNodeMachineType = properties['dataNodeMachineType'] %}
{% set dataNodeDiskSizeGb = properties['dataNodeDiskSizeGb'] %}
{% set dataNodeDiskType = properties['dataNodeDiskType'] %}
{% set sourceImage = 'https://www.googleapis.com/compute/v1/projects/influxdata-dev/global/images/influxdata-debian-9-influxdb-enterprise-v20180917' %}
{% set network = properties['network'] %}
{% set subnetwork = properties['subnetwork'] %}

resources:
- name: {{ deployment }}-meta
  type: meta-node.jinja
  properties:
    zone: {{ zone }}
    network: {{ network }}
    {% if properties.get("subnetwork") %}
    subnetwork: {{ properties["subnetwork"] }}
    {% endif %}
    metaNodeMachineType: {{ metaNodeMachineType }}
    metaNodeDiskSizeGb: {{ metaNodeDiskSizeGb }}
    sourceImage: {{ sourceImage }}
    licenseKey: {{ licenseKey }}
    startupScripts:
      - setup-common.sh
      - setup-meta.sh

- name: {{ deployment }}-data
  type: data-node.jinja
  properties:
    zone: {{ zone }}
    network: {{ network }}
    {% if properties.get("subnetwork") %}
    subnetwork: {{ properties["subnetwork"] }}
    {% endif %}
    dataNodeMachineType: {{ dataNodeMachineType }}
    dataNodeDiskSizeGb: {{ dataNodeDiskSizeGb }}
    sourceImage: {{ sourceImage }}
    licenseKey: {{ licenseKey }}
    startupScripts:
      - setup-common.sh
      - setup-data.sh

- name: {{ deployment }}-rtc
  type: runtime-config.jinja
  properties:
    waiterTimeout: 600

- name: {{ deployment }}-net
  type: network.jinja
  properties:
    zone: {{ zone }}
    network: {{ network }}
    {% if properties.get("subnetwork") %}
    subnetwork: {{ properties["subnetwork"] }}
    {% endif %}
